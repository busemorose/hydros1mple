% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/IPS.R
\name{IPS}
\alias{IPS}
\title{Compute the Indicateur Piézométrique Standardisé (IPS)}
\usage{
IPS(
  date,
  value,
  min_months = 15,
  min_days_in_month = 15,
  target_month = NULL,
  target_year = NULL,
  ref_year_min = NULL,
  ref_year_max = NULL
)
}
\arguments{
\item{date}{A vector of class \code{Date} indicating the time axis of the data.}

\item{value}{A numeric vector of the same length as \code{date}, giving the values to analyze (e.g., water level).}

\item{min_months}{Integer. Minimum number of years required for the target month across the time series
(default: 15). If fewer years are available, the function stops.}

\item{min_days_in_month}{Integer. Minimum number of daily values required in the selected target month
for it to be used (default: 15).}

\item{target_month}{Optional integer (1–12). Target month to compute IPS up to. If \code{NULL}, the latest
month in the data is used.}

\item{target_year}{Optional integer. Target year to compute IPS up to. If \code{NULL}, the latest year
in the data is used.}

\item{ref_year_min}{Optional integer. First year of the reference period used for normalization.
If \code{NULL}, the earliest year in the dataset is used.}

\item{ref_year_max}{Optional integer. Last year of the reference period used for normalization.
If \code{NULL}, the latest year in the dataset is used.}
}
\value{
A named list of \code{data.table} objects. Each list element corresponds to a moving average
window (e.g., \code{"m1"}, \code{"m2"}, \code{"m3"}, etc.), and contains two columns:
\describe{
\item{date}{The timestamp at the start of each window.}
\item{IPS}{The standardized value (normally distributed), computed month-by-month over the reference period.}
}
}
\description{
This function calculates a standardized index (IPS) for groundwater or other time series
by comparing the current situation to the distribution of past conditions over a defined
reference period. The method follows a density-based approach using a kernel estimator
and projection onto the standard normal distribution.
}
\details{
The index is computed for multiple rolling monthly windows (1 to 12 months), with normalization
performed separately for each calendar month based on the selected reference period. The result
is a list of data.tables containing the IPS time series for each window size.

The function follows these main steps for each moving average window:
\enumerate{
\item Compute rolling mean of monthly values over the selected window size.
\item For each calendar month (January to December), extract values in that month for all years.
\item Use a smoothed kernel density (Epanechnikov) to estimate the probability density function.
\item Convert the density to a cumulative distribution function (CDF).
\item Project the current values onto the standard normal using the inverse CDF (via \code{qnorm}).
}

This process allows month-specific normalization, preserving the seasonal signal.
}
\examples{
# Example with synthetic data
set.seed(123)
dates <- seq(as.Date("1980-01-01"), as.Date("2023-12-31"), by = "day")
values <- sin(2 * pi * yday(dates) / 365) + rnorm(length(dates), 0, 0.5) + 5
ips_result <- IPS(dates, values)

}
